{"ast":null,"code":"/**\r\n * DevExtreme (esm/__internal/ui/hierarchical_collection/m_data_adapter.js)\r\n * Version: 24.2.7\r\n * Build date: Mon Apr 28 2025\r\n *\r\n * Copyright (c) 2012 - 2025 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport query from \"../../../common/data/query\";\nimport storeHelper from \"../../../common/data/store_helper\";\nimport Class from \"../../../core/class\";\nimport { noop } from \"../../../core/utils/common\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { each } from \"../../../core/utils/iterator\";\nimport { isDefined, isFunction } from \"../../../core/utils/type\";\nimport TextBox from \"../../../ui/text_box\";\nimport errors from \"../../../ui/widget/ui.errors\";\nimport uiSearchBoxMixin from \"../../../ui/widget/ui.search_box_mixin\";\nimport HierarchicalDataConverter from \"./m_data_converter\";\nconst EXPANDED = \"expanded\";\nconst SELECTED = \"selected\";\nconst DISABLED = \"disabled\";\nuiSearchBoxMixin.setEditorClass(TextBox);\nconst DataAdapter = Class.inherit({\n  ctor(options) {\n    this.options = {};\n    extend(this.options, this._defaultOptions(), options);\n    this.options.dataConverter.setDataAccessors(this.options.dataAccessors);\n    this._selectedNodesKeys = [];\n    this._expandedNodesKeys = [];\n    this._dataStructure = [];\n    this._createInternalDataStructure();\n    this.getTreeNodes();\n  },\n  setOption(name, value) {\n    this.options[name] = value;\n    if (\"recursiveSelection\" === name) {\n      this._updateSelection();\n    }\n  },\n  _defaultOptions: () => ({\n    dataAccessors: void 0,\n    items: [],\n    multipleSelection: true,\n    recursiveSelection: false,\n    recursiveExpansion: false,\n    rootValue: 0,\n    searchValue: \"\",\n    dataType: \"tree\",\n    searchMode: \"contains\",\n    dataConverter: new HierarchicalDataConverter(),\n    onNodeChanged: noop,\n    sort: null\n  }),\n  _createInternalDataStructure() {\n    this._initialDataStructure = this.options.dataConverter.createPlainStructure(this.options.items, this.options.rootValue, this.options.dataType);\n    this._dataStructure = this.options.searchValue.length ? this.search(this.options.searchValue) : this._initialDataStructure;\n    this.options.dataConverter._dataStructure = this._dataStructure;\n    this._updateSelection();\n    this._updateExpansion();\n  },\n  _updateSelection() {\n    if (this.options.recursiveSelection) {\n      this._setChildrenSelection();\n      this._setParentSelection();\n    }\n    this._selectedNodesKeys = this._updateNodesKeysArray(SELECTED);\n  },\n  _updateExpansion(key) {\n    if (this.options.recursiveExpansion) {\n      key ? this._updateOneBranch(key) : this._setParentExpansion();\n    }\n    this._expandedNodesKeys = this._updateNodesKeysArray(EXPANDED);\n  },\n  _updateNodesKeysArray(property) {\n    const that = this;\n    let array = [];\n    each(that._getDataBySelectionMode(), (_, node) => {\n      if (!that._isNodeVisible(node)) {\n        return;\n      }\n      if (node.internalFields[property]) {\n        if (property === EXPANDED || that.options.multipleSelection) {\n          array.push(node.internalFields.key);\n        } else {\n          array.length && that.toggleSelection(array[0], false, true);\n          array = [node.internalFields.key];\n        }\n      }\n    });\n    return array;\n  },\n  _getDataBySelectionMode() {\n    return this.options.multipleSelection ? this.getData() : this.getFullData();\n  },\n  _isNodeVisible: node => false !== node.internalFields.item.visible,\n  _getByKey(data, key) {\n    return data === this._dataStructure ? this.options.dataConverter._getByKey(key) : this.options.dataConverter.getByKey(data, key);\n  },\n  _setChildrenSelection() {\n    const that = this;\n    each(this._dataStructure, (_, node) => {\n      if (!node.internalFields.childrenKeys.length) {\n        return;\n      }\n      const isSelected = node.internalFields.selected;\n      true === isSelected && that._toggleChildrenSelection(node, isSelected);\n    });\n  },\n  _setParentSelection() {\n    const that = this;\n    each(this._dataStructure, (_, node) => {\n      const parent = that.options.dataConverter.getParentNode(node);\n      if (parent && node.internalFields.parentKey !== that.options.rootValue) {\n        that._iterateParents(node, parent => {\n          const newParentState = that._calculateSelectedState(parent);\n          that._setFieldState(parent, SELECTED, newParentState);\n        });\n      }\n    });\n  },\n  _setParentExpansion() {\n    const that = this;\n    each(this._dataStructure, (_, node) => {\n      if (!node.internalFields.expanded) {\n        return;\n      }\n      that._updateOneBranch(node.internalFields.key);\n    });\n  },\n  _updateOneBranch(key) {\n    const that = this;\n    const node = this.getNodeByKey(key);\n    that._iterateParents(node, parent => {\n      that._setFieldState(parent, EXPANDED, true);\n    });\n  },\n  _iterateChildren(node, recursive, callback, processedKeys) {\n    if (!isFunction(callback)) {\n      return;\n    }\n    const that = this;\n    const nodeKey = node.internalFields.key;\n    processedKeys = processedKeys || [];\n    if (-1 === processedKeys.indexOf(nodeKey)) {\n      processedKeys.push(nodeKey);\n      each(node.internalFields.childrenKeys, (_, key) => {\n        const child = that.getNodeByKey(key);\n        callback(child);\n        if (child.internalFields.childrenKeys.length && recursive) {\n          that._iterateChildren(child, recursive, callback, processedKeys);\n        }\n      });\n    }\n  },\n  _iterateParents(node, callback, processedKeys) {\n    if (node.internalFields.parentKey === this.options.rootValue || !isFunction(callback)) {\n      return;\n    }\n    processedKeys = processedKeys || [];\n    const {\n      key: key\n    } = node.internalFields;\n    if (-1 === processedKeys.indexOf(key)) {\n      processedKeys.push(key);\n      const parent = this.options.dataConverter.getParentNode(node);\n      if (parent) {\n        callback(parent);\n        if (parent.internalFields.parentKey !== this.options.rootValue) {\n          this._iterateParents(parent, callback, processedKeys);\n        }\n      }\n    }\n  },\n  _calculateSelectedState(node) {\n    const itemsCount = node.internalFields.childrenKeys.length;\n    let selectedItemsCount = 0;\n    let invisibleItemsCount = 0;\n    let result = false;\n    for (let i = 0; i <= itemsCount - 1; i++) {\n      const childNode = this.getNodeByKey(node.internalFields.childrenKeys[i]);\n      const isChildInvisible = false === childNode.internalFields.item.visible;\n      const childState = childNode.internalFields.selected;\n      if (isChildInvisible) {\n        invisibleItemsCount++;\n        continue;\n      }\n      if (childState) {\n        selectedItemsCount++;\n      } else if (void 0 === childState) {\n        selectedItemsCount += .5;\n      }\n    }\n    if (selectedItemsCount) {\n      result = selectedItemsCount === itemsCount - invisibleItemsCount ? true : void 0;\n    }\n    return result;\n  },\n  _toggleChildrenSelection(node, state) {\n    const that = this;\n    this._iterateChildren(node, true, child => {\n      if (that._isNodeVisible(child)) {\n        that._setFieldState(child, SELECTED, state);\n      }\n    });\n  },\n  _setFieldState(node, field, state) {\n    if (node.internalFields[field] === state) {\n      return;\n    }\n    node.internalFields[field] = state;\n    if (node.internalFields.publicNode) {\n      node.internalFields.publicNode[field] = state;\n    }\n    this.options.dataAccessors.setters[field](node.internalFields.item, state);\n    this.options.onNodeChanged(node);\n  },\n  _markChildren(keys) {\n    const that = this;\n    each(keys, (_, key) => {\n      const index = that.getIndexByKey(key);\n      const node = that.getNodeByKey(key);\n      that._dataStructure[index] = 0;\n      node.internalFields.childrenKeys.length && that._markChildren(node.internalFields.childrenKeys);\n    });\n  },\n  _removeNode(key) {\n    const node = this.getNodeByKey(key);\n    this._dataStructure[this.getIndexByKey(key)] = 0;\n    this._markChildren(node.internalFields.childrenKeys);\n    const that = this;\n    let counter = 0;\n    const items = extend([], this._dataStructure);\n    each(items, (index, item) => {\n      if (!item) {\n        that._dataStructure.splice(index - counter, 1);\n        counter++;\n      }\n    });\n  },\n  _addNode(item) {\n    const {\n      dataConverter: dataConverter\n    } = this.options;\n    const node = dataConverter._convertItemToNode(item, this.options.dataAccessors.getters.parentKey(item));\n    this._dataStructure = this._dataStructure.concat(node);\n    this._initialDataStructure = this._initialDataStructure.concat(node);\n    dataConverter._dataStructure = dataConverter._dataStructure.concat(node);\n  },\n  _updateFields() {\n    this.options.dataConverter.updateChildrenKeys();\n    this._updateSelection();\n    this._updateExpansion();\n  },\n  getSelectedNodesKeys() {\n    return this._selectedNodesKeys;\n  },\n  getExpandedNodesKeys() {\n    return this._expandedNodesKeys;\n  },\n  getData() {\n    return this._dataStructure;\n  },\n  getFullData() {\n    return this._initialDataStructure;\n  },\n  getNodeByItem(item) {\n    let result = null;\n    each(this._dataStructure, (_, node) => {\n      if (node.internalFields.item === item) {\n        result = node;\n        return false;\n      }\n    });\n    return result;\n  },\n  getNodesByItems(items) {\n    const that = this;\n    const nodes = [];\n    each(items, (_, item) => {\n      const node = that.getNodeByItem(item);\n      node && nodes.push(node);\n    });\n    return nodes;\n  },\n  getNodeByKey(key, data) {\n    return this._getByKey(data || this._getDataBySelectionMode(), key);\n  },\n  getTreeNodes() {\n    return this.options.dataConverter.convertToPublicNodes(this.getRootNodes());\n  },\n  getItemsCount() {\n    return this.options.dataConverter.getItemsCount();\n  },\n  getVisibleItemsCount() {\n    return this.options.dataConverter.getVisibleItemsCount();\n  },\n  getPublicNode: node => node.internalFields.publicNode,\n  getRootNodes() {\n    return this.getChildrenNodes(this.options.rootValue);\n  },\n  getChildrenNodes(parentKey) {\n    return query(this._dataStructure, {\n      langParams: this.options.langParams\n    }).filter([\"internalFields.parentKey\", parentKey]).toArray();\n  },\n  getIndexByKey(key) {\n    return this.options.dataConverter.getIndexByKey(key);\n  },\n  addItem(item) {\n    this._addNode(item);\n    this._updateFields();\n  },\n  removeItem(key) {\n    this._removeNode(key);\n    this._updateFields();\n  },\n  toggleSelection(key, state, selectRecursive) {\n    const isSingleModeUnselect = this._isSingleModeUnselect(state);\n    const node = this._getByKey(selectRecursive || isSingleModeUnselect ? this._initialDataStructure : this._dataStructure, key);\n    this._setFieldState(node, SELECTED, state);\n    if (this.options.recursiveSelection && !selectRecursive) {\n      state ? this._setChildrenSelection() : this._toggleChildrenSelection(node, state);\n      this._setParentSelection();\n    }\n    this._selectedNodesKeys = this._updateNodesKeysArray(SELECTED);\n  },\n  _isSingleModeUnselect(selectionState) {\n    return !this.options.multipleSelection && !selectionState;\n  },\n  toggleNodeDisabledState(key, state) {\n    const node = this.getNodeByKey(key);\n    this._setFieldState(node, DISABLED, state);\n  },\n  toggleSelectAll(state) {\n    if (!isDefined(state)) {\n      return;\n    }\n    const that = this;\n    const lastSelectedKey = that._selectedNodesKeys[that._selectedNodesKeys.length - 1];\n    const dataStructure = that._isSingleModeUnselect(state) ? this._initialDataStructure : this._dataStructure;\n    each(dataStructure, (index, node) => {\n      if (!that._isNodeVisible(node)) {\n        return;\n      }\n      that._setFieldState(node, SELECTED, state);\n    });\n    that._selectedNodesKeys = that._updateNodesKeysArray(SELECTED);\n    if (!state && that.options.selectionRequired) {\n      that.toggleSelection(lastSelectedKey, true);\n    }\n  },\n  isAllSelected() {\n    if (this.getSelectedNodesKeys().length) {\n      return this.getSelectedNodesKeys().length === this.getVisibleItemsCount() ? true : void 0;\n    }\n    return false;\n  },\n  toggleExpansion(key, state) {\n    const node = this.getNodeByKey(key);\n    this._setFieldState(node, EXPANDED, state);\n    if (state) {\n      this._updateExpansion(key);\n    }\n    this._expandedNodesKeys = this._updateNodesKeysArray(EXPANDED);\n  },\n  isFiltered(item) {\n    return !this.options.searchValue.length || !!this._filterDataStructure(this.options.searchValue, [item]).length;\n  },\n  _createCriteria(selector, value, operation) {\n    const searchFilter = [];\n    if (!Array.isArray(selector)) {\n      return [selector, operation, value];\n    }\n    each(selector, (i, item) => {\n      searchFilter.push([item, operation, value], \"or\");\n    });\n    searchFilter.pop();\n    return searchFilter;\n  },\n  _filterDataStructure(filterValue, dataStructure) {\n    const selector = this.options.searchExpr || this.options.dataAccessors.getters.display;\n    const operation = uiSearchBoxMixin.getOperationBySearchMode(this.options.searchMode);\n    const criteria = this._createCriteria(selector, filterValue, operation);\n    dataStructure = dataStructure || this._initialDataStructure;\n    return query(dataStructure, {\n      langParams: this.options.langParams\n    }).filter(criteria).toArray();\n  },\n  search(searchValue) {\n    const that = this;\n    let matches = this._filterDataStructure(searchValue);\n    const {\n      dataConverter: dataConverter\n    } = this.options;\n    !function lookForParents(matches, index) {\n      const {\n        length: length\n      } = matches;\n      while (index < length) {\n        const node = matches[index];\n        if (node.internalFields.parentKey === that.options.rootValue) {\n          index++;\n          continue;\n        }\n        const parent = dataConverter.getParentNode(node);\n        if (!parent) {\n          errors.log(\"W1007\", node.internalFields.parentKey, node.internalFields.key);\n          index++;\n          continue;\n        }\n        if (!parent.internalFields.expanded) {\n          that._setFieldState(parent, EXPANDED, true);\n        }\n        if (matches.includes(parent)) {\n          index++;\n          continue;\n        }\n        matches.splice(index, 0, parent);\n        lookForParents(matches, index);\n      }\n    }(matches, 0);\n    if (this.options.sort) {\n      matches = storeHelper.queryByOptions(query(matches), {\n        sort: this.options.sort,\n        langParams: this.options.langParams\n      }).toArray();\n    }\n    dataConverter._indexByKey = {};\n    each(matches, (index, node) => {\n      node.internalFields.childrenKeys = [];\n      dataConverter._indexByKey[node.internalFields.key] = index;\n    });\n    dataConverter._dataStructure = matches;\n    dataConverter.setChildrenKeys();\n    return dataConverter._dataStructure;\n  }\n});\nexport default DataAdapter;","map":{"version":3,"names":["query","storeHelper","Class","noop","extend","each","isDefined","isFunction","TextBox","errors","uiSearchBoxMixin","HierarchicalDataConverter","EXPANDED","SELECTED","DISABLED","setEditorClass","DataAdapter","inherit","ctor","options","_defaultOptions","dataConverter","setDataAccessors","dataAccessors","_selectedNodesKeys","_expandedNodesKeys","_dataStructure","_createInternalDataStructure","getTreeNodes","setOption","name","value","_updateSelection","items","multipleSelection","recursiveSelection","recursiveExpansion","rootValue","searchValue","dataType","searchMode","onNodeChanged","sort","_initialDataStructure","createPlainStructure","length","search","_updateExpansion","_setChildrenSelection","_setParentSelection","_updateNodesKeysArray","key","_updateOneBranch","_setParentExpansion","property","that","array","_getDataBySelectionMode","_","node","_isNodeVisible","internalFields","push","toggleSelection","getData","getFullData","item","visible","_getByKey","data","getByKey","childrenKeys","isSelected","selected","_toggleChildrenSelection","parent","getParentNode","parentKey","_iterateParents","newParentState","_calculateSelectedState","_setFieldState","expanded","getNodeByKey","_iterateChildren","recursive","callback","processedKeys","nodeKey","indexOf","child","itemsCount","selectedItemsCount","invisibleItemsCount","result","i","childNode","isChildInvisible","childState","state","field","publicNode","setters","_markChildren","keys","index","getIndexByKey","_removeNode","counter","splice","_addNode","_convertItemToNode","getters","concat","_updateFields","updateChildrenKeys","getSelectedNodesKeys","getExpandedNodesKeys","getNodeByItem","getNodesByItems","nodes","convertToPublicNodes","getRootNodes","getItemsCount","getVisibleItemsCount","getPublicNode","getChildrenNodes","langParams","filter","toArray","addItem","removeItem","selectRecursive","isSingleModeUnselect","_isSingleModeUnselect","selectionState","toggleNodeDisabledState","toggleSelectAll","lastSelectedKey","dataStructure","selectionRequired","isAllSelected","toggleExpansion","isFiltered","_filterDataStructure","_createCriteria","selector","operation","searchFilter","Array","isArray","pop","filterValue","searchExpr","display","getOperationBySearchMode","criteria","matches","lookForParents","log","includes","queryByOptions","_indexByKey","setChildrenKeys"],"sources":["C:/Users/Sofia/Desktop/Репозиторий ЦК/internship_project/client/node_modules/devextreme/esm/__internal/ui/hierarchical_collection/m_data_adapter.js"],"sourcesContent":["/**\r\n * DevExtreme (esm/__internal/ui/hierarchical_collection/m_data_adapter.js)\r\n * Version: 24.2.7\r\n * Build date: Mon Apr 28 2025\r\n *\r\n * Copyright (c) 2012 - 2025 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport query from \"../../../common/data/query\";\r\nimport storeHelper from \"../../../common/data/store_helper\";\r\nimport Class from \"../../../core/class\";\r\nimport {\r\n    noop\r\n} from \"../../../core/utils/common\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    each\r\n} from \"../../../core/utils/iterator\";\r\nimport {\r\n    isDefined,\r\n    isFunction\r\n} from \"../../../core/utils/type\";\r\nimport TextBox from \"../../../ui/text_box\";\r\nimport errors from \"../../../ui/widget/ui.errors\";\r\nimport uiSearchBoxMixin from \"../../../ui/widget/ui.search_box_mixin\";\r\nimport HierarchicalDataConverter from \"./m_data_converter\";\r\nconst EXPANDED = \"expanded\";\r\nconst SELECTED = \"selected\";\r\nconst DISABLED = \"disabled\";\r\nuiSearchBoxMixin.setEditorClass(TextBox);\r\nconst DataAdapter = Class.inherit({\r\n    ctor(options) {\r\n        this.options = {};\r\n        extend(this.options, this._defaultOptions(), options);\r\n        this.options.dataConverter.setDataAccessors(this.options.dataAccessors);\r\n        this._selectedNodesKeys = [];\r\n        this._expandedNodesKeys = [];\r\n        this._dataStructure = [];\r\n        this._createInternalDataStructure();\r\n        this.getTreeNodes()\r\n    },\r\n    setOption(name, value) {\r\n        this.options[name] = value;\r\n        if (\"recursiveSelection\" === name) {\r\n            this._updateSelection()\r\n        }\r\n    },\r\n    _defaultOptions: () => ({\r\n        dataAccessors: void 0,\r\n        items: [],\r\n        multipleSelection: true,\r\n        recursiveSelection: false,\r\n        recursiveExpansion: false,\r\n        rootValue: 0,\r\n        searchValue: \"\",\r\n        dataType: \"tree\",\r\n        searchMode: \"contains\",\r\n        dataConverter: new HierarchicalDataConverter,\r\n        onNodeChanged: noop,\r\n        sort: null\r\n    }),\r\n    _createInternalDataStructure() {\r\n        this._initialDataStructure = this.options.dataConverter.createPlainStructure(this.options.items, this.options.rootValue, this.options.dataType);\r\n        this._dataStructure = this.options.searchValue.length ? this.search(this.options.searchValue) : this._initialDataStructure;\r\n        this.options.dataConverter._dataStructure = this._dataStructure;\r\n        this._updateSelection();\r\n        this._updateExpansion()\r\n    },\r\n    _updateSelection() {\r\n        if (this.options.recursiveSelection) {\r\n            this._setChildrenSelection();\r\n            this._setParentSelection()\r\n        }\r\n        this._selectedNodesKeys = this._updateNodesKeysArray(SELECTED)\r\n    },\r\n    _updateExpansion(key) {\r\n        if (this.options.recursiveExpansion) {\r\n            key ? this._updateOneBranch(key) : this._setParentExpansion()\r\n        }\r\n        this._expandedNodesKeys = this._updateNodesKeysArray(EXPANDED)\r\n    },\r\n    _updateNodesKeysArray(property) {\r\n        const that = this;\r\n        let array = [];\r\n        each(that._getDataBySelectionMode(), ((_, node) => {\r\n            if (!that._isNodeVisible(node)) {\r\n                return\r\n            }\r\n            if (node.internalFields[property]) {\r\n                if (property === EXPANDED || that.options.multipleSelection) {\r\n                    array.push(node.internalFields.key)\r\n                } else {\r\n                    array.length && that.toggleSelection(array[0], false, true);\r\n                    array = [node.internalFields.key]\r\n                }\r\n            }\r\n        }));\r\n        return array\r\n    },\r\n    _getDataBySelectionMode() {\r\n        return this.options.multipleSelection ? this.getData() : this.getFullData()\r\n    },\r\n    _isNodeVisible: node => false !== node.internalFields.item.visible,\r\n    _getByKey(data, key) {\r\n        return data === this._dataStructure ? this.options.dataConverter._getByKey(key) : this.options.dataConverter.getByKey(data, key)\r\n    },\r\n    _setChildrenSelection() {\r\n        const that = this;\r\n        each(this._dataStructure, ((_, node) => {\r\n            if (!node.internalFields.childrenKeys.length) {\r\n                return\r\n            }\r\n            const isSelected = node.internalFields.selected;\r\n            true === isSelected && that._toggleChildrenSelection(node, isSelected)\r\n        }))\r\n    },\r\n    _setParentSelection() {\r\n        const that = this;\r\n        each(this._dataStructure, ((_, node) => {\r\n            const parent = that.options.dataConverter.getParentNode(node);\r\n            if (parent && node.internalFields.parentKey !== that.options.rootValue) {\r\n                that._iterateParents(node, (parent => {\r\n                    const newParentState = that._calculateSelectedState(parent);\r\n                    that._setFieldState(parent, SELECTED, newParentState)\r\n                }))\r\n            }\r\n        }))\r\n    },\r\n    _setParentExpansion() {\r\n        const that = this;\r\n        each(this._dataStructure, ((_, node) => {\r\n            if (!node.internalFields.expanded) {\r\n                return\r\n            }\r\n            that._updateOneBranch(node.internalFields.key)\r\n        }))\r\n    },\r\n    _updateOneBranch(key) {\r\n        const that = this;\r\n        const node = this.getNodeByKey(key);\r\n        that._iterateParents(node, (parent => {\r\n            that._setFieldState(parent, EXPANDED, true)\r\n        }))\r\n    },\r\n    _iterateChildren(node, recursive, callback, processedKeys) {\r\n        if (!isFunction(callback)) {\r\n            return\r\n        }\r\n        const that = this;\r\n        const nodeKey = node.internalFields.key;\r\n        processedKeys = processedKeys || [];\r\n        if (-1 === processedKeys.indexOf(nodeKey)) {\r\n            processedKeys.push(nodeKey);\r\n            each(node.internalFields.childrenKeys, ((_, key) => {\r\n                const child = that.getNodeByKey(key);\r\n                callback(child);\r\n                if (child.internalFields.childrenKeys.length && recursive) {\r\n                    that._iterateChildren(child, recursive, callback, processedKeys)\r\n                }\r\n            }))\r\n        }\r\n    },\r\n    _iterateParents(node, callback, processedKeys) {\r\n        if (node.internalFields.parentKey === this.options.rootValue || !isFunction(callback)) {\r\n            return\r\n        }\r\n        processedKeys = processedKeys || [];\r\n        const {\r\n            key: key\r\n        } = node.internalFields;\r\n        if (-1 === processedKeys.indexOf(key)) {\r\n            processedKeys.push(key);\r\n            const parent = this.options.dataConverter.getParentNode(node);\r\n            if (parent) {\r\n                callback(parent);\r\n                if (parent.internalFields.parentKey !== this.options.rootValue) {\r\n                    this._iterateParents(parent, callback, processedKeys)\r\n                }\r\n            }\r\n        }\r\n    },\r\n    _calculateSelectedState(node) {\r\n        const itemsCount = node.internalFields.childrenKeys.length;\r\n        let selectedItemsCount = 0;\r\n        let invisibleItemsCount = 0;\r\n        let result = false;\r\n        for (let i = 0; i <= itemsCount - 1; i++) {\r\n            const childNode = this.getNodeByKey(node.internalFields.childrenKeys[i]);\r\n            const isChildInvisible = false === childNode.internalFields.item.visible;\r\n            const childState = childNode.internalFields.selected;\r\n            if (isChildInvisible) {\r\n                invisibleItemsCount++;\r\n                continue\r\n            }\r\n            if (childState) {\r\n                selectedItemsCount++\r\n            } else if (void 0 === childState) {\r\n                selectedItemsCount += .5\r\n            }\r\n        }\r\n        if (selectedItemsCount) {\r\n            result = selectedItemsCount === itemsCount - invisibleItemsCount ? true : void 0\r\n        }\r\n        return result\r\n    },\r\n    _toggleChildrenSelection(node, state) {\r\n        const that = this;\r\n        this._iterateChildren(node, true, (child => {\r\n            if (that._isNodeVisible(child)) {\r\n                that._setFieldState(child, SELECTED, state)\r\n            }\r\n        }))\r\n    },\r\n    _setFieldState(node, field, state) {\r\n        if (node.internalFields[field] === state) {\r\n            return\r\n        }\r\n        node.internalFields[field] = state;\r\n        if (node.internalFields.publicNode) {\r\n            node.internalFields.publicNode[field] = state\r\n        }\r\n        this.options.dataAccessors.setters[field](node.internalFields.item, state);\r\n        this.options.onNodeChanged(node)\r\n    },\r\n    _markChildren(keys) {\r\n        const that = this;\r\n        each(keys, ((_, key) => {\r\n            const index = that.getIndexByKey(key);\r\n            const node = that.getNodeByKey(key);\r\n            that._dataStructure[index] = 0;\r\n            node.internalFields.childrenKeys.length && that._markChildren(node.internalFields.childrenKeys)\r\n        }))\r\n    },\r\n    _removeNode(key) {\r\n        const node = this.getNodeByKey(key);\r\n        this._dataStructure[this.getIndexByKey(key)] = 0;\r\n        this._markChildren(node.internalFields.childrenKeys);\r\n        const that = this;\r\n        let counter = 0;\r\n        const items = extend([], this._dataStructure);\r\n        each(items, ((index, item) => {\r\n            if (!item) {\r\n                that._dataStructure.splice(index - counter, 1);\r\n                counter++\r\n            }\r\n        }))\r\n    },\r\n    _addNode(item) {\r\n        const {\r\n            dataConverter: dataConverter\r\n        } = this.options;\r\n        const node = dataConverter._convertItemToNode(item, this.options.dataAccessors.getters.parentKey(item));\r\n        this._dataStructure = this._dataStructure.concat(node);\r\n        this._initialDataStructure = this._initialDataStructure.concat(node);\r\n        dataConverter._dataStructure = dataConverter._dataStructure.concat(node)\r\n    },\r\n    _updateFields() {\r\n        this.options.dataConverter.updateChildrenKeys();\r\n        this._updateSelection();\r\n        this._updateExpansion()\r\n    },\r\n    getSelectedNodesKeys() {\r\n        return this._selectedNodesKeys\r\n    },\r\n    getExpandedNodesKeys() {\r\n        return this._expandedNodesKeys\r\n    },\r\n    getData() {\r\n        return this._dataStructure\r\n    },\r\n    getFullData() {\r\n        return this._initialDataStructure\r\n    },\r\n    getNodeByItem(item) {\r\n        let result = null;\r\n        each(this._dataStructure, ((_, node) => {\r\n            if (node.internalFields.item === item) {\r\n                result = node;\r\n                return false\r\n            }\r\n        }));\r\n        return result\r\n    },\r\n    getNodesByItems(items) {\r\n        const that = this;\r\n        const nodes = [];\r\n        each(items, ((_, item) => {\r\n            const node = that.getNodeByItem(item);\r\n            node && nodes.push(node)\r\n        }));\r\n        return nodes\r\n    },\r\n    getNodeByKey(key, data) {\r\n        return this._getByKey(data || this._getDataBySelectionMode(), key)\r\n    },\r\n    getTreeNodes() {\r\n        return this.options.dataConverter.convertToPublicNodes(this.getRootNodes())\r\n    },\r\n    getItemsCount() {\r\n        return this.options.dataConverter.getItemsCount()\r\n    },\r\n    getVisibleItemsCount() {\r\n        return this.options.dataConverter.getVisibleItemsCount()\r\n    },\r\n    getPublicNode: node => node.internalFields.publicNode,\r\n    getRootNodes() {\r\n        return this.getChildrenNodes(this.options.rootValue)\r\n    },\r\n    getChildrenNodes(parentKey) {\r\n        return query(this._dataStructure, {\r\n            langParams: this.options.langParams\r\n        }).filter([\"internalFields.parentKey\", parentKey]).toArray()\r\n    },\r\n    getIndexByKey(key) {\r\n        return this.options.dataConverter.getIndexByKey(key)\r\n    },\r\n    addItem(item) {\r\n        this._addNode(item);\r\n        this._updateFields()\r\n    },\r\n    removeItem(key) {\r\n        this._removeNode(key);\r\n        this._updateFields()\r\n    },\r\n    toggleSelection(key, state, selectRecursive) {\r\n        const isSingleModeUnselect = this._isSingleModeUnselect(state);\r\n        const node = this._getByKey(selectRecursive || isSingleModeUnselect ? this._initialDataStructure : this._dataStructure, key);\r\n        this._setFieldState(node, SELECTED, state);\r\n        if (this.options.recursiveSelection && !selectRecursive) {\r\n            state ? this._setChildrenSelection() : this._toggleChildrenSelection(node, state);\r\n            this._setParentSelection()\r\n        }\r\n        this._selectedNodesKeys = this._updateNodesKeysArray(SELECTED)\r\n    },\r\n    _isSingleModeUnselect(selectionState) {\r\n        return !this.options.multipleSelection && !selectionState\r\n    },\r\n    toggleNodeDisabledState(key, state) {\r\n        const node = this.getNodeByKey(key);\r\n        this._setFieldState(node, DISABLED, state)\r\n    },\r\n    toggleSelectAll(state) {\r\n        if (!isDefined(state)) {\r\n            return\r\n        }\r\n        const that = this;\r\n        const lastSelectedKey = that._selectedNodesKeys[that._selectedNodesKeys.length - 1];\r\n        const dataStructure = that._isSingleModeUnselect(state) ? this._initialDataStructure : this._dataStructure;\r\n        each(dataStructure, ((index, node) => {\r\n            if (!that._isNodeVisible(node)) {\r\n                return\r\n            }\r\n            that._setFieldState(node, SELECTED, state)\r\n        }));\r\n        that._selectedNodesKeys = that._updateNodesKeysArray(SELECTED);\r\n        if (!state && that.options.selectionRequired) {\r\n            that.toggleSelection(lastSelectedKey, true)\r\n        }\r\n    },\r\n    isAllSelected() {\r\n        if (this.getSelectedNodesKeys().length) {\r\n            return this.getSelectedNodesKeys().length === this.getVisibleItemsCount() ? true : void 0\r\n        }\r\n        return false\r\n    },\r\n    toggleExpansion(key, state) {\r\n        const node = this.getNodeByKey(key);\r\n        this._setFieldState(node, EXPANDED, state);\r\n        if (state) {\r\n            this._updateExpansion(key)\r\n        }\r\n        this._expandedNodesKeys = this._updateNodesKeysArray(EXPANDED)\r\n    },\r\n    isFiltered(item) {\r\n        return !this.options.searchValue.length || !!this._filterDataStructure(this.options.searchValue, [item]).length\r\n    },\r\n    _createCriteria(selector, value, operation) {\r\n        const searchFilter = [];\r\n        if (!Array.isArray(selector)) {\r\n            return [selector, operation, value]\r\n        }\r\n        each(selector, ((i, item) => {\r\n            searchFilter.push([item, operation, value], \"or\")\r\n        }));\r\n        searchFilter.pop();\r\n        return searchFilter\r\n    },\r\n    _filterDataStructure(filterValue, dataStructure) {\r\n        const selector = this.options.searchExpr || this.options.dataAccessors.getters.display;\r\n        const operation = uiSearchBoxMixin.getOperationBySearchMode(this.options.searchMode);\r\n        const criteria = this._createCriteria(selector, filterValue, operation);\r\n        dataStructure = dataStructure || this._initialDataStructure;\r\n        return query(dataStructure, {\r\n            langParams: this.options.langParams\r\n        }).filter(criteria).toArray()\r\n    },\r\n    search(searchValue) {\r\n        const that = this;\r\n        let matches = this._filterDataStructure(searchValue);\r\n        const {\r\n            dataConverter: dataConverter\r\n        } = this.options;\r\n        ! function lookForParents(matches, index) {\r\n            const {\r\n                length: length\r\n            } = matches;\r\n            while (index < length) {\r\n                const node = matches[index];\r\n                if (node.internalFields.parentKey === that.options.rootValue) {\r\n                    index++;\r\n                    continue\r\n                }\r\n                const parent = dataConverter.getParentNode(node);\r\n                if (!parent) {\r\n                    errors.log(\"W1007\", node.internalFields.parentKey, node.internalFields.key);\r\n                    index++;\r\n                    continue\r\n                }\r\n                if (!parent.internalFields.expanded) {\r\n                    that._setFieldState(parent, EXPANDED, true)\r\n                }\r\n                if (matches.includes(parent)) {\r\n                    index++;\r\n                    continue\r\n                }\r\n                matches.splice(index, 0, parent);\r\n                lookForParents(matches, index)\r\n            }\r\n        }(matches, 0);\r\n        if (this.options.sort) {\r\n            matches = storeHelper.queryByOptions(query(matches), {\r\n                sort: this.options.sort,\r\n                langParams: this.options.langParams\r\n            }).toArray()\r\n        }\r\n        dataConverter._indexByKey = {};\r\n        each(matches, ((index, node) => {\r\n            node.internalFields.childrenKeys = [];\r\n            dataConverter._indexByKey[node.internalFields.key] = index\r\n        }));\r\n        dataConverter._dataStructure = matches;\r\n        dataConverter.setChildrenKeys();\r\n        return dataConverter._dataStructure\r\n    }\r\n});\r\nexport default DataAdapter;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}